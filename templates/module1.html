{% extends 'base.html' %}
{% block content %}
<div class="sheet">
  <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3 mb-3">Volver al Menú Principal</a>

  <h2 class="mb-3">Publicador de Redes Sociales</h2>

  <div class="panel">
    <form id="publishForm" method="post" enctype="multipart/form-data">
      <!-- Mensaje -->
      <div class="mb-3">
        <label for="mensaje" class="form-label">Mensaje (máximo 270 caracteres):</label>
        <textarea name="mensaje" id="mensaje" class="form-control" maxlength="270" rows="5" placeholder="Escribe tu mensaje aquí..." required></textarea>
      </div>

      <!-- Redes -->
      <label class="form-label">Redes Sociales a Publicar:</label>
      <div class="mb-2 form-check">
        <input type="checkbox" name="facebook" class="form-check-input" id="facebook" checked>
        <label class="form-check-label" for="facebook">Facebook</label>
      </div>
      <div class="mb-3 form-check">
        <input type="checkbox" name="twitter" class="form-check-input" id="twitter" checked>
        <label class="form-check-label" for="twitter">X (Twitter)</label>
      </div>

      <!-- Imagen -->
      <div class="mb-3">
        <label for="imagen" class="form-label">Imagen (opcional):</label>
        <div id="drop-area" class="drop-area">
          <p id="drop-text" class="mb-2">Arrastra y suelta tu imagen aquí o haz clic para seleccionarla</p>
          <input type="file" name="imagen" id="imagen" accept="image/*">
          <button type="button" id="remove-btn" class="btn btn-sm btn-danger mt-2" style="display:none;">Remover</button>
          <div id="preview"></div>
        </div>
      </div>

      <button type="submit" id="publish-btn" class="btn btn-primary">Publicar</button>
    </form>
  </div>
</div>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('imagen');
  const dropText = document.getElementById('drop-text');
  const removeBtn = document.getElementById('remove-btn');

  ['dragenter','dragover','dragleave','drop'].forEach(ev=>{
    dropArea.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); }, false);
    document.body.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); }, false);
  });
  ['dragenter','dragover'].forEach(ev=>{
    dropArea.addEventListener(ev, ()=> dropArea.classList.add('highlight'), false);
  });
  ['dragleave','drop'].forEach(ev=>{
    dropArea.addEventListener(ev, ()=> dropArea.classList.remove('highlight'), false);
  });

  dropArea.addEventListener('drop', e=>{
    fileInput.files = e.dataTransfer.files;
    handleFiles();
  });
  dropArea.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', handleFiles);

  function handleFiles(){
    const files = fileInput.files;
    if(files && files[0]){
      const file = files[0];
      const reader = new FileReader();
      reader.onload = e=>{
        const preview = document.getElementById('preview');
        preview.innerHTML = `
          <img src="${e.target.result}" alt="${file.name}">
          <p>${file.name}</p>
        `;
        removeBtn.style.display = 'inline-block';
      };
      reader.readAsDataURL(file);
    }
  }

  removeBtn.addEventListener('click', e=>{
    e.stopPropagation();
    fileInput.value = "";
    document.getElementById('preview').innerHTML = "";
    removeBtn.style.display = 'none';
  });

  // Deshabilitar botón en envío
  const publishForm = document.getElementById('publishForm');
  const publishBtn = document.getElementById('publish-btn');
  publishForm.addEventListener('submit', ()=>{
    publishBtn.disabled = true;
    publishBtn.innerText = "Publicando, por favor espere...";
  });
</script>
{% endblock %}
