{% extends 'base.html' %}
{% block content %}
<div class="sheet sheet-wide">
  <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3 mb-3">Volver al Menú Principal</a>

  <div class="d-flex align-items-center justify-content-between">
    <h2 class="mb-2">{{ module_name }}</h2>
    <a href="{{ url_for('credenciales.add_psp') }}" class="btn btn-primary">
      <i class="fa-solid fa-user-plus me-1"></i> Añadir PSP
    </a>
  </div>

  <div class="d-flex align-items-center justify-content-between mb-2">
    <h4 class="mb-0">Listado de PSPs</h4>
    <form method="get" class="d-flex gap-2">
      <input type="text" name="search" value="{{ search or '' }}" class="form-control"
             placeholder="Buscar por ID, nombre, correo, dirección, servicio...">
      <button type="submit" class="btn btn-secondary">Buscar</button>
    </form>
  </div>

  <div class="table-wrap">
    <div class="table-responsive">
      <table class="table table-sm table-bordered table-striped table-hover align-middle mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <!-- <th>Correo</th> -->
            <!-- <th>Dirección</th> -->
            <!-- <th>Servicio</th> -->
            <th>Estado</th>
            <th>Expira</th>
            <th style="width:150px">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for item in history %}
          <tr>
            <td class="small">{{ item.id }}</td>
            <td class="small">{{ item.name }}</td>
            <!-- <td class="small">{{ item.email }}</td> -->
            <!-- <td class="small">{{ item.direccion }}</td> -->
            <!-- <td class="small">{{ item.servicio or '-' }}</td> -->
            <td>
              {% if item.valid in ['ACTIVO', True, 'True'] %}
                <span class="badge rounded-pill bg-success">Activo</span>
              {% else %}
                <span class="badge rounded-pill bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td class="small">{{ item.expiration_date.strftime('%Y-%m-%d') if item.expiration_date else '-' }}</td>
            <td class="text-nowrap">
              <a href="{{ url_for('credenciales.verify_credentials', psp_id=item.id) }}"
                 class="btn btn-sm btn-info" title="Visualizar">
                <i class="fa-solid fa-eye"></i>
              </a>
              <a href="{{ url_for('credenciales.edit_psp', psp_id=item.id) }}"
                 class="btn btn-sm btn-warning" title="Editar">
                <i class="fa-solid fa-pen"></i>
              </a>
              <a href="{{ url_for('credenciales.qr_psp', psp_id=item.id) }}"
                 class="btn btn-sm btn-light" title="Descargar QR">
                <i class="fa-solid fa-qrcode"></i>
              </a>
              <form method="post" action="{{ url_for('credenciales.delete_credentials', psp_id=item.id) }}"
                    style="display:inline;" onsubmit="return confirm('¿Eliminar este registro?');">
                <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="8" class="text-center text-muted-custom">Sin registros</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
